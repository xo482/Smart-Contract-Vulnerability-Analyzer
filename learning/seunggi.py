import pandas as pd

# 데이터셋 불러오기
weakness_list = ['block number dependency', 'dangerous delegatecall', 'ether frozen', 'ether strict equality',
                    'integer overflow', 'reentrancy', 'timestamp dependency', 'unchecked external call', 'test']

weakness = weakness_list[7]

df = pd.read_csv('/workspace/sku3343/dataset/dgl_graph/{}_og.csv'.format(weakness))


label_counts = df['label'].value_counts(normalize=True)
ratio_of_ones = label_counts.get(1, 0)
print(f"작업 전 1의 비율 : {ratio_of_ones:.2%}")


if ratio_of_ones < 0.63:

    num_zeros_to_remove = len(df[df['label'] == 0]) - int(ratio_of_ones / 0.63 * len(df[df['label'] == 0]))
    print(f"삭제할 행의 개수: {num_zeros_to_remove}")

    zeros_to_remove_idx = df[df['label'] == 0].index[:num_zeros_to_remove]

    df = df.drop(zeros_to_remove_idx)

    new_label_counts = df['label'].value_counts(normalize=True)
    new_ratio_of_ones = new_label_counts.get(1, 0)
    print(f"1의 비율: {new_ratio_of_ones:.2%}")

    df.to_csv('/workspace/sku3343/dataset/dgl_graph/{}.csv'.format(weakness), index=False)
    print("새로운 파일이 생성되었습니다.")
else:
    print("원하는 비율에 도달할 수 없습니다.")