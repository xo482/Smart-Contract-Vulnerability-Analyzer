import pandas as pd
import os

# 총 데이터를 저장할 데이터 프레임 생성
total_data = {
    'contract': [],
    'block number dependency': [],
    'dangerous delegatecall': [],
    'ether frozen': [],
    'ether strict equality': [],
    'integer overflow': [],
    'reentrancy': [],
    'timestamp dependency': [],
    'unchecked external call': []
}

total_df = pd.DataFrame(total_data)

# 취약점 목록
weakness_name = ['block number dependency', 'dangerous delegatecall', 'ether frozen', 'ether strict equality',
                 'integer overflow', 'reentrancy', 'timestamp dependency', 'unchecked external call']

# 각 취약점에 대한 CSV 파일을 읽고 총 데이터 프레임에 추가
for weakness in weakness_name:
    weakness_df = pd.read_csv(f'/workspace/sku3343/dataset/dgl_graph/{weakness}.csv')
    
    for index, row in weakness_df.iterrows():
        contract = row['file']
        label = row['label']
        
        # 계약이 이미 총 데이터 프레임에 있는지 확인
        if contract in total_df['contract'].values:
            if label != 0:
                # 이미 있는 경우 해당 취약점 열을 업데이트
                total_df.loc[total_df['contract'] == contract, weakness] = label
        else:
            # 없는 경우 새 행을 추가
            new_row = {
                'contract': contract,
                'block number dependency': 0,
                'dangerous delegatecall': 0,
                'ether frozen': 0,
                'ether strict equality': 0,
                'integer overflow': 0,
                'reentrancy': 0,
                'timestamp dependency': 0,
                'unchecked external call': 0
            }
            if label != 0:
                new_row[weakness] = label
            total_df = pd.concat([total_df, pd.DataFrame([new_row])], ignore_index=True)

# 총 데이터 프레임을 CSV 파일로 저장
csv_file_name = 'totalDataCSV.csv'
total_df.to_csv(csv_file_name, index=False)

print(f"CSV 파일 '{csv_file_name}'이 생성되었습니다.")
